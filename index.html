<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Проверка статуса паспорта</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"
    crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/material-ui/5.0.0-alpha.37/umd/material-ui.production.min.js"
    crossorigin></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    #root {
      max-width: 500px;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script>
    const { useState, useEffect } = React;
    const {
      TextField,
      Button,
      Card,
      CardContent,
      Typography,
      CircularProgress,
      Dialog,
      DialogTitle,
      DialogContent,
      Box, // Импортируем Box
    } = MaterialUI;

    function PassportStatusChecker() {
      const [passportNumber, setPassportNumber] = useState(localStorage.getItem("passportNumber") || "");
      const [statusData, setStatusData] = useState(null);
      const [loading, setLoading] = useState(false);
      const [openModal, setOpenModal] = useState(false);

      useEffect(() => {
        localStorage.setItem("passportNumber", passportNumber);
      }, [passportNumber]);

      const fetchPassportStatus = async () => {
        setLoading(true);
        try {
          const response = await fetch(`https://info.midpass.ru/api/request/${passportNumber}`);
          if (response.ok) {
            const data = await response.json();
            setStatusData(data);
          } else {
            alert("Ошибка при запросе данных");
          }
        } catch (error) {
          console.error("Ошибка:", error);
          alert("Ошибка сети");
        } finally {
          setLoading(false);
        }
      };

      const statusesDescriptions = [
        [["заявление создано"], "Заявление ожидает принятия в обработку"],
        [["готово"], "Принятие заявления в консульстве или ждет отправления диппочтой в РФ"],
        [["отправлено"], "Заявление отправлено диппочтой в РФ. В зависимости о консульства, может висеть в этом статусе до месяца"],
        [["принято в обработку", "приостановлено"], "диппочта дошла до МИДа"],
        [["отправлено на согласование", "на согласовании", "дополнительная проверка"], "Госбезопасность (и прочие органы с правом вето) осуществляет проверку"],
        [["согласовано письмом", "согласовано"], "Госбезопасность убедилась, что доступа к гостайне у подавшего заявления нет.", "NOTE: \"согласовано письмом\" - по итогам трекинга некоторого количества паспортов, это единственный статус, который может в итоге вывалиться в \"отказ в согласовании\". \"согласовано\" - более поздний шаг, с ним уже ни у кого ничего плохого не наблюдалось."],
        [["персонализация разрешена", "на персонализации", "отправлено в МРЦОД"], "Печать паспорта Гознаком."],
        [["паспорт поступил"], "напечатанный паспорт приехал с Гознака в МИД"],
        [["паспорт отправлен в РКЗУ"], "Паспорт отправлен диппочтой в консульство. Возможно, что паспорт уже приехал в консульство, но почту еще не разобрали. Если статус не обновляется около месяца, имеет смысл написать в посольство и попросить проверить состояние паспорта"],
        [["паспорт поступил"], "Паспорт поступил в консульство из МИД"],
        [["паспорт верен"], "паспорт готов к выдаче в консульстве"],
        [["паспорт выдан", "отказ в согласовании", "отмена изготовления паспорта", "почтовое отправление"]]
      ];

      let description;

      return React.createElement(
        Card,
        null,
        React.createElement(
          CardContent,
          null,
          React.createElement(
            Typography,
            { variant: "h5", component: "h2", gutterBottom: true },
            "Проверка статуса паспорта"
          ),
          React.createElement(
            Typography,
            { variant: "body1", color: "textSecondary", gutterBottom: true },
            "Введите номер заявления, чтобы узнать актуальный статус и процент завершения процесса. " +
            "Для просмотра графической схемы статусов нажмите ",
            React.createElement("a", { href: "#", onClick: () => setOpenModal(true) }, "здесь"),
            "."
          ),
          React.createElement(TextField, {
            label: "Введите номер заявления",
            variant: "outlined",
            fullWidth: true,
            margin: "normal",
            value: passportNumber,
            onChange: (e) => setPassportNumber(e.target.value),
          }),
          React.createElement(
            Button,
            {
              variant: "contained",
              color: "primary",
              fullWidth: true,
              onClick: fetchPassportStatus,
              disabled: loading || !passportNumber,
            },
            "Проверить"
          ),
          loading && React.createElement(CircularProgress, { style: { marginTop: "20px" } }),
          statusData && React.createElement(
            "div",
            { style: { marginTop: "20px" } },
            React.createElement(
              Typography,
              { variant: "h6" },
              "Результаты:"
            ),
            React.createElement(
              Typography,
              null,
              `Внутренний статус: ${statusData.internalStatus.name}`
            ),
            React.createElement(
              Typography,
              null,
              `Процент завершения: ${statusData.internalStatus.percent}%`
            ),
            (description = statusesDescriptions.find(([internalStatusesList]) => internalStatusesList.includes(statusData.internalStatus.name))?.[1])
              ? React.createElement(
                Typography,
                null,
                `Описание: ${description}`
              ) : null,
            React.createElement(
              'div',
              { id: 'diagramContainer' },
              ''
            )
          )
        ),
        React.createElement(
          Dialog,
          { open: openModal, onClose: () => setOpenModal(false) },
          React.createElement(DialogTitle, null, "Граф статусов"),
          React.createElement(DialogContent, null, React.createElement("div", { id: "diagramContainer", style: { width: "100%", height: "400px" } }))
        ),
        // Подвал с использованием Box
        React.createElement(
          Box,
          {
            component: 'footer',
            sx: {
              mt: 2,
              py: 2,
              textAlign: 'center',
              borderTop: '1px solid #ccc'
            }
          },
          React.createElement(
            Typography,
            { variant: "body2" },
            "Сервис использует данные с сайта ",
            React.createElement("a", { href: "https://info.midpass.ru", target: "_blank", rel: "noopener noreferrer" }, "info.midpass.ru"),
            ", и отображаемая информация полностью зависит от данных, предоставленных этим API. Если API не отвечает, попробуйте повторить запрос позже."
          ),
          React.createElement(
            Typography,
            { variant: "body2" },
            "Источник информации: ",
            React.createElement("a", { href: "https://forum.awd.ru/viewtopic.php?p=11124426&sid=c9f23ee4c5284ff486bf8bb82ca473e9#p11124426", target: "_blank", rel: "noopener noreferrer" }, "forum.awd.ru")
          )
        )
      );
    }

    ReactDOM.render(React.createElement(PassportStatusChecker), document.getElementById("root"));
  </script>
</body>

</html>