<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Проверка статуса паспорта</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/material-ui/5.0.0-alpha.37/umd/material-ui.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/react-image-zoom/1.1.3/index.umd.js"
      crossorigin
    ></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      #root {
        max-width: 500px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      const { useState, useEffect } = React;
      const {
        TextField,
        Button,
        Card,
        CardContent,
        Typography,
        CircularProgress,
        Dialog,
        DialogTitle,
        DialogContent,
        IconButton,
      } = MaterialUI;

      function PassportStatusChecker() {
        const [passportNumber, setPassportNumber] = useState(
          localStorage.getItem("passportNumber") || ""
        );
        const [statusData, setStatusData] = useState(null);
        const [loading, setLoading] = useState(false);
        const [openModal, setOpenModal] = useState(false);

        useEffect(() => {
          localStorage.setItem("passportNumber", passportNumber);
        }, [passportNumber]);

        const fetchPassportStatus = async () => {
          setLoading(true);
          try {
            const response = await fetch(
              `https://info.midpass.ru/api/request/${passportNumber}`
            );
            if (response.ok) {
              const data = await response.json();
              setStatusData(data);
            } else {
              alert("Ошибка при запросе данных");
            }
          } catch (error) {
            console.error("Ошибка:", error);
            alert("Ошибка сети");
          } finally {
            setLoading(false);
          }
        };

        const getStatusDescription = (percent) => {
          switch (percent) {
            case 0:
              return "Заявление создано. Ожидает принятия в обработку.";
            case 5:
              return "Готово. Заявление ожидает отправления диппочтой в Россию.";
            case 10:
              return "Отправлено. Заявление отправлено диппочтой в Россию.";
            case 20:
              return "Принято в обработку. Диппочта дошла до МИДа.";
            case 30:
              return "Отправлено на согласование. Ожидание дополнительных проверок.";
            case 60:
              return "Согласовано письмом. Проверка завершена, доступ к гостайне подтвержден.";
            case 70:
              return "Персонализация разрешена. Печать паспорта начата.";
            case 80:
              return "Паспорт поступил в МИД. Ожидает отправления в консульство.";
            case 90:
              return "Паспорт поступил в консульство.";
            case 100:
              return "Паспорт готов к выдаче.";
            case -1:
              return "Паспорт выдан или отменен.";
            default:
              return "Статус неизвестен.";
          }
        };

        return React.createElement(
          Card,
          null,
          React.createElement(
            CardContent,
            null,
            React.createElement(
              Typography,
              { variant: "h5", component: "h2", gutterBottom: true },
              "Проверка статуса паспорта"
            ),
            React.createElement(
              Typography,
              { variant: "body1", color: "textSecondary", gutterBottom: true },
              "Введите номер заявления, чтобы узнать актуальный статус и процент завершения процесса. " +
                "Для просмотра графической схемы статусов нажмите ",
              React.createElement(
                "a",
                { href: "#", onClick: () => setOpenModal(true) },
                "здесь"
              ),
              "."
            ),
            React.createElement(TextField, {
              label: "Введите номер заявления",
              variant: "outlined",
              fullWidth: true,
              margin: "normal",
              value: passportNumber,
              onChange: (e) => setPassportNumber(e.target.value),
            }),
            React.createElement(
              Button,
              {
                variant: "contained",
                color: "primary",
                fullWidth: true,
                onClick: fetchPassportStatus,
                disabled: loading || !passportNumber,
              },
              "Проверить"
            ),
            loading &&
              React.createElement(CircularProgress, {
                style: { marginTop: "20px" },
              }),
            statusData &&
              React.createElement(
                "div",
                { style: { marginTop: "20px" } },
                React.createElement(
                  Typography,
                  { variant: "h6" },
                  "Результаты:"
                ),
                React.createElement(
                  Typography,
                  null,
                  `Внутренний статус: ${statusData.internalStatus.name}`
                ),
                React.createElement(
                  Typography,
                  null,
                  `Процент завершения: ${statusData.internalStatus.percent}%`
                ),
                React.createElement(
                  Typography,
                  null,
                  getStatusDescription(statusData.internalStatus.percent)
                )
              )
          ),
          React.createElement(
            Dialog,
            {
              open: openModal,
              onClose: () => setOpenModal(false),
            },
            React.createElement(DialogTitle, null, "Граф статусов"),
            React.createElement(
              DialogContent,
              null,
              React.createElement(
                "div",
                null,
                React.createElement("img", {
                  src: "/passport/statuses.jpeg",
                  alt: "Граф статусов",
                  style: { width: "100%", cursor: "zoom-in" },
                  onClick: () =>
                    window.open("/passport/statuses.jpeg", "_blank"),
                })
              )
            )
          )
        );
      }

      ReactDOM.render(
        React.createElement(PassportStatusChecker),
        document.getElementById("root")
      );
    </script>
  </body>
</html>
